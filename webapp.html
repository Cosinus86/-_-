<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ú–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #fff;
            overscroll-behavior: none;
        }

        /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ñ–æ–Ω —Ä–∞–∑–¥–µ–ª–∞ */
        .section-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .section-bg-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.3) blur(20px);
            transform: scale(1.1);
        }

        .section-gradient {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(15, 15, 15, 0.2) 0%,
                rgba(15, 15, 15, 0.4) 20%,
                rgba(15, 15, 15, 0.7) 40%,
                #0f0f0f 70%,
                #0f0f0f 100%
            );
        }

        /* –®–∞–ø–∫–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º */
        .section-header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 12px 16px;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            padding: 14px 20px;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .section-title-btn:active {
            background: rgba(255, 255, 255, 0.12);
            transform: scale(0.98);
        }

        .btn-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-arrow {
            font-size: 20px;
            opacity: 0.7;
            transition: opacity 0.2s;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .btn-arrow:active {
            background: rgba(255, 255, 255, 0.1);
        }

        /* –°–µ—Ç–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (3 —Ä—è–¥–∞) */
        .content-wrapper {
            padding: 16px;
            padding-bottom: 80px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-width: 800px;
            margin: 0 auto;
        }

        .grid-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 16/9;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .grid-item:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.08);
        }

        .special-item {
            grid-column: 1 / -1;
            aspect-ratio: 32/9;
            background: linear-gradient(135deg, rgba(62, 166, 255, 0.1), rgba(62, 166, 255, 0.05));
            border: 1px solid rgba(62, 166, 255, 0.2);
        }

        .special-link {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            font-size: 18px;
            font-weight: 500;
        }

        .special-link small {
            font-size: 14px;
            opacity: 0.7;
            margin-top: 4px;
        }

        .video-number {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 2;
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .grid-item:hover .play-icon {
            opacity: 1;
            background: rgba(0, 0, 0, 0.9);
        }

        .material-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 8px;
            font-size: 11px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
        }

        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .nav-arrows {
            flex: 0 0 auto;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-btn:active {
            background: rgba(255, 255, 255, 0.12);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .page-numbers {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: 4px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0 8px;
        }

        .page-numbers::-webkit-scrollbar {
            display: none;
        }

        .page-rect {
            min-width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .page-rect.active {
            background: rgba(62, 166, 255, 0.2);
            border-color: rgba(62, 166, 255, 0.5);
            color: white;
        }

        .page-rect:active:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .page-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 8px;
        }

        .page-rect:hover .page-tooltip {
            opacity: 1;
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫ */
        .loader {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #3ea6ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .retry-button {
            background: #3ea6ff;
            border: none;
            color: #0f0f0f;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <!-- –§–æ–Ω —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞–∑–¥–µ–ª–∞ -->
    <div class="section-background" id="sectionBackground">
        <img class="section-bg-image" id="sectionBgImage" src="" alt="" crossorigin="anonymous">
        <div class="section-gradient"></div>
    </div>

    <!-- –®–∞–ø–∫–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
    <div class="section-header">
        <button class="section-title-btn" id="sectionBtn">
            <div class="btn-content">
                <span class="btn-arrow">‚Üê</span>
                <span id="sectionName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <span class="btn-arrow">‚Üí</span>
            </div>
            <span>üè†</span>
        </button>
    </div>

    <!-- –°–µ—Ç–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
    <div class="content-wrapper">
        <div class="grid-container" id="gridContainer">
            <div class="loader">
                <div class="spinner"></div>
                <div>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏...</div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination">
        <div class="nav-arrows">
            <button class="nav-btn" id="prevBtn">‚Üê</button>
        </div>
        <div class="page-numbers" id="pageNumbers"></div>
        <div class="nav-arrows">
            <button class="nav-btn" id="nextBtn">‚Üí</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Web App
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω[citation:2]
        tg.setHeaderColor('#000000'); // –ß–µ—Ä–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å[citation:2]
        tg.setBackgroundColor('#0f0f0f'); // –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω[citation:2]
        
        // Telegram —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å ready() –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è[citation:4]
        tg.ready();

        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        const ITEMS_PER_PAGE = 28; // 3 —Ä—è–¥–∞ –ø–æ 9 + 1 –±–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        let ALL_SECTIONS = [];
        let CURRENT_SECTION_INDEX = 0;
        let currentPage = 1;
        let totalPages = 1;

        // ===== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• =====
        function loadAllData() {
            showLoader();
            const urlParams = new URLSearchParams(window.location.search);
            const jsonData = urlParams.get('data');
            
            if (!jsonData) {
                showError('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.');
                return;
            }
            
            try {
                const decoded = decodeURIComponent(jsonData);
                const allData = JSON.parse(decoded);
                
                if (!allData.sections || !allData.sections.length) {
                    showError('üì≠ –í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–∞–∑–¥–µ–ª–æ–≤.');
                    return;
                }
                
                ALL_SECTIONS = allData.sections;
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–æ–≤: ${ALL_SECTIONS.length}`);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª
                initSection(0);
                hideLoader();
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
                showError('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö: ' + err.message);
            }
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –†–ê–ó–î–ï–õ–ê =====
        function initSection(sectionIndex) {
            if (sectionIndex < 0 || sectionIndex >= ALL_SECTIONS.length) return;
            
            CURRENT_SECTION_INDEX = sectionIndex;
            const section = ALL_SECTIONS[CURRENT_SECTION_INDEX];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('sectionName').textContent = section.name;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            const bgImg = document.getElementById('sectionBgImage');
            if (section.cover) {
                bgImg.src = section.cover;
            } else {
                bgImg.src = '';
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
            const itemsPerPage = ITEMS_PER_PAGE - 1; // -1 –¥–ª—è –±–ª–æ–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            totalPages = Math.max(1, Math.ceil((section.materials?.length || 0) / itemsPerPage));
            currentPage = 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateGrid();
            updatePagination();
            updateSectionNavigation();
        }

        // ===== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ï–¢–ö–ò –ú–ê–¢–ï–†–ò–ê–õ–û–í =====
        function updateGrid() {
            const grid = document.getElementById('gridContainer');
            const section = ALL_SECTIONS[CURRENT_SECTION_INDEX];
            const materials = section.materials || [];
            
            if (!materials.length) {
                grid.innerHTML = `
                    <div class="error-message">
                        <div class="error-icon">üì≠</div>
                        <div>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                    </div>
                `;
                return;
            }
            
            // –†–∞—Å—á–µ—Ç –≤–∏–¥–∏–º—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const itemsPerPage = ITEMS_PER_PAGE - 1;
            const startIdx = (currentPage - 1) * itemsPerPage;
            const endIdx = Math.min(startIdx + itemsPerPage, materials.length);
            const pageMaterials = materials.slice(startIdx, endIdx);
            
            let html = '';
            
            // 1. –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–π)
            html += `
                <div class="grid-item special-item" onclick="tg.showPopup({
                    title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–∞',
                    message: 'üìä –†–∞–∑–¥–µ–ª: ${escapeHtml(section.name)}\\nüìÅ –ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${materials.length}\\nüìÑ –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${currentPage}/${totalPages}',
                    buttons: [{id: 'ok', type: 'ok'}]
                })">
                    <div class="special-link">
                        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–¥–µ–ª–∞<br>
                        <small>${materials.length} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</small>
                    </div>
                </div>
            `;
            
            // 2. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π
            pageMaterials.forEach((mat, localIndex) => {
                const globalNumber = startIdx + localIndex + 1;
                const typeIcon = getFileTypeIcon(mat.typ);
                const playIcon = mat.typ === 'video' ? '‚ñ∂Ô∏è' : mat.typ === 'audio' ? 'üîä' : 'üìÑ';
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –ø—Ä–µ–≤—å—é —á–µ—Ä–µ–∑ Telegram File API
                const thumbUrl = mat.thb 
                    ? `https://api.telegram.org/file/bot${getBotTokenFromUrl()}/${mat.thb}`
                    : null;
                
                html += `
                    <div class="grid-item" onclick="openTelegramMaterial(${JSON.stringify(mat)})">
                        <div class="video-number">${globalNumber}</div>
                        
                        <div class="video-thumbnail">
                            ${thumbUrl ? 
                                `<img src="${thumbUrl}" alt="–ü—Ä–µ–≤—å—é" loading="lazy" onerror="this.style.display='none'">` :
                                `<div style="width:100%; height:100%; background:${getMaterialColor(mat.typ)}; display:flex; align-items:center; justify-content:center;">
                                    <span style="font-size:24px; opacity:0.8;">${typeIcon}</span>
                                </div>`
                            }
                            <div class="play-icon">${playIcon}</div>
                        </div>
                        
                        <div class="material-caption">
                            ${typeIcon} ${mat.typ.toUpperCase()}
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }

        // ===== –û–¢–ö–†–´–¢–ò–ï –§–ê–ô–õ–û–í –ß–ï–†–ï–ó TELEGRAM API =====
        function openTelegramMaterial(material) {
            if (!material.fid) {
                tg.showAlert('‚ùå –§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è');
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã Telegram Web App –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤
            switch(material.typ) {
                case 'video':
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ Telegram
                    try {
                        // –ú–µ—Ç–æ–¥ openVideo –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö Telegram Web App[citation:2]
                        if (typeof tg.openVideo === 'function') {
                            tg.openVideo(material.fid);
                        } else {
                            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
                            tg.openLink(`tg://openvideo?file_id=${material.fid}`);
                        }
                    } catch (e) {
                        tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ');
                    }
                    break;
                    
                case 'photo':
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ Telegram
                    try {
                        if (typeof tg.openPhoto === 'function') {
                            tg.openPhoto(material.fid);
                        } else {
                            tg.openLink(`tg://openphoto?file_id=${material.fid}`);
                        }
                    } catch (e) {
                        tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ');
                    }
                    break;
                    
                case 'audio':
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ –Ω–∞—Ç–∏–≤–Ω—ã–π –ø–ª–µ–µ—Ä Telegram
                    try {
                        if (typeof tg.openAudio === 'function') {
                            tg.openAudio(material.fid);
                        } else {
                            tg.openLink(`tg://openaudio?file_id=${material.fid}`);
                        }
                    } catch (e) {
                        tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∞—É–¥–∏–æ');
                    }
                    break;
                    
                default:
                    // –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –º–µ—Ç–æ–¥
                    try {
                        if (typeof tg.openDocument === 'function') {
                            tg.openDocument(material.fid);
                        } else {
                            tg.openLink(`tg://opendocument?file_id=${material.fid}`);
                        }
                    } catch (e) {
                        tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª');
                    }
            }
            
            // –í–µ–¥–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–∫—Ä—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            logMaterialOpen(material);
        }

        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –†–ê–ó–î–ï–õ–ê–ú–ò =====
        function updateSectionNavigation() {
            const btn = document.getElementById('sectionBtn');
            const section = ALL_SECTIONS[CURRENT_SECTION_INDEX];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç—Ä–µ–ª–æ–∫
            const leftArrow = btn.querySelector('.btn-arrow:nth-child(1)');
            const rightArrow = btn.querySelector('.btn-arrow:nth-child(3)');
            
            leftArrow.onclick = (e) => {
                e.stopPropagation();
                changeSection(-1);
            };
            
            rightArrow.onclick = (e) => {
                e.stopPropagation();
                changeSection(1);
            };
            
            // –ö–Ω–æ–ø–∫–∞ "–î–æ–º–æ–π" –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            btn.onclick = (e) => {
                if (!e.target.classList.contains('btn-arrow')) {
                    tg.close();
                }
            };
        }

        function changeSection(delta) {
            const newIndex = CURRENT_SECTION_INDEX + delta;
            if (newIndex >= 0 && newIndex < ALL_SECTIONS.length) {
                // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
                document.getElementById('gridContainer').style.opacity = '0.5';
                setTimeout(() => {
                    initSection(newIndex);
                    document.getElementById('gridContainer').style.opacity = '1';
                }, 150);
            } else {
                // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≥—Ä–∞–Ω–∏—Ü
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('soft');
                }
            }
        }

        // ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø =====
        function updatePagination() {
            const container = document.getElementById('pageNumbers');
            let html = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ 7 —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            const maxVisible = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage + 1 < maxVisible) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                html += `
                    <button class="page-rect ${isActive ? 'active' : ''}" 
                            onclick="goToPage(${i})"
                            title="–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${i}">
                        ${i}
                        <div class="page-tooltip">–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${i}</div>
                    </button>
                `;
            }
            
            container.innerHTML = html;
            
            // –ö–Ω–æ–ø–∫–∏ –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('prevBtn').onclick = () => goToPage(currentPage - 1);
            document.getElementById('nextBtn').onclick = () => goToPage(currentPage + 1);
        }

        function goToPage(page) {
            if (page < 1 || page > totalPages) return;
            
            // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
            const grid = document.getElementById('gridContainer');
            grid.style.opacity = '0.5';
            
            setTimeout(() => {
                currentPage = page;
                updateGrid();
                updatePagination();
                grid.style.opacity = '1';
                
                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.selectionChanged();
                }
            }, 150);
        }

        // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
        function getMaterialColor(type) {
            const colors = {
                'video': 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)',
                'photo': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'document': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'audio': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
            };
            return colors[type] || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }

        function getFileTypeIcon(type) {
            const icons = {
                'video': 'üé¨',
                'photo': 'üñºÔ∏è',
                'document': 'üìÑ',
                'audio': 'üéµ'
            };
            return icons[type] || 'üìÅ';
        }

        function getBotTokenFromUrl() {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ URL (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ)
            const url = new URL(window.location.href);
            return url.searchParams.get('bot_token') || 'YOUR_BOT_TOKEN';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function logMaterialOpen(material) {
            // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebApp.CloudStorage[citation:2]
            console.log(`–û—Ç–∫—Ä—ã—Ç –º–∞—Ç–µ—Ä–∏–∞–ª: ${material.typ}, ID: ${material.fid}`);
        }

        function showLoader() {
            const loader = document.querySelector('.loader');
            if (loader) loader.style.display = 'block';
        }

        function hideLoader() {
            const loader = document.querySelector('.loader');
            if (loader) loader.style.display = 'none';
        }

        function showError(msg) {
            document.getElementById('gridContainer').innerHTML = `
                <div class="error-message">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div>${msg}</div>
                    <button class="retry-button" onclick="location.reload()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                </div>
            `;
            hideLoader();
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï =====
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Web App[citation:4]
            tg.BackButton.hide(); // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telegram
            tg.onEvent('viewportChanged', (e) => {
                // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
                console.log('Viewport changed:', e);
            });
            
            // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('prevBtn').onclick = () => goToPage(currentPage - 1);
            document.getElementById('nextBtn').onclick = () => goToPage(currentPage + 1);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadAllData();
            
            // –°–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ[citation:10]
            if (typeof tg.postEvent === 'function') {
                tg.postEvent('web_app_ready');
            }
        });
    </script>
</body>
</html>
